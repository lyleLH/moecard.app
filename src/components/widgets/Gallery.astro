---
import 'swiper/css';
import 'swiper/css/effect-cards';
import 'swiper/css/pagination';
import 'swiper/css/grid';
import 'photoswipe/style.css';
import Twemoji from '../common/Twemoji.astro';

interface Props {
  title?: string;
  subtitle?: string;
  images: {
    src: string;
    alt: string;
  }[];
  classes?: {
    container?: string;
    title?: string;
    subtitle?: string;
    grid?: string;
  };
}

const {
  title = '',
  subtitle = '',
  images = [],
  classes = {},
} = Astro.props;
---

<section class:list={['relative overflow-hidden', classes?.container]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    {title && (
      <h2 class:list={['text-center mb-4 flex items-center justify-center gap-2', classes?.title]}>
        <Twemoji emoji="üé®" />
        {title}
      </h2>
    )}
    {subtitle && (
      <p class:list={['text-center mb-8', classes?.subtitle]}>
        {subtitle}
      </p>
    )}
    
    <!-- ÊªëÂä®ÊèêÁ§∫ -->
    <div class="text-center mb-8 text-gray-500 dark:text-gray-400 flex items-center justify-center gap-2">
      <Twemoji emoji="üëÜ" />
      <span>Â∑¶Âè≥ÊªëÂä®Êü•ÁúãÊõ¥Â§öÁ≤æÂΩ©‰ΩúÂìÅ</span>
      <Twemoji emoji="‚ú®" />
    </div>
    
    <div class="swiper gallery-swiper">
      <div class="swiper-wrapper">
        {images.map((image) => (
          <div class="swiper-slide">
            <a 
              href={image.src}
              class="gallery-item block relative group overflow-hidden rounded-2xl shadow-md hover:shadow-xl transition-all duration-300"
              data-pswp-width="1200"
              data-pswp-height="1600"
            >
              <div class="aspect-[3/4]">
                <img
                  src={image.src}
                  alt={image.alt}
                  class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  loading="lazy"
                  decoding="async"
                />
                <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
              </div>
            </a>
          </div>
        ))}
      </div>
    </div>
    
    <!-- ÂàÜÈ°µÊåáÁ§∫Âô® -->
    <div class="swiper-pagination mt-8"></div>
  </div>
</section>

<script>
import Swiper from 'swiper';
import { Grid, Pagination, Autoplay } from 'swiper/modules';
import PhotoSwipe from 'photoswipe';
import PhotoSwipeLightbox from 'photoswipe/lightbox';

// ÂàùÂßãÂåñ Swiper
new Swiper('.gallery-swiper', {
  modules: [Grid, Pagination, Autoplay],
  slidesPerView: 1.2,
  grid: {
    rows: 2,
    fill: 'row'
  },
  spaceBetween: 16,
  centeredSlides: true,
  loop: true,
  speed: 1000,
  autoplay: {
    delay: 3000,
    disableOnInteraction: false,
    pauseOnMouseEnter: true,
  },
  pagination: {
    el: '.swiper-pagination',
    clickable: true,
    dynamicBullets: true,
    dynamicMainBullets: 3,
    renderBullet: function (index, className) {
      return '<span class="' + className + '"><span class="dot"></span></span>';
    },
  },
  breakpoints: {
    640: {
      slidesPerView: 2.2,
      spaceBetween: 20,
    },
    768: {
      slidesPerView: 3.2,
      spaceBetween: 24,
    },
    1024: {
      slidesPerView: 4.2,
      spaceBetween: 24,
    },
  },
});

// ÂàùÂßãÂåñ PhotoSwipe
const lightbox = new PhotoSwipeLightbox({
  gallery: 'section',
  children: '.gallery-item',
  pswpModule: PhotoSwipe,
  padding: { top: 30, bottom: 30, left: 10, right: 10 },
  bgOpacity: 0.9,
  showHideAnimationType: 'fade',
});

lightbox.init();
</script>

<style>
/* Swiper Ëá™ÂÆö‰πâÊ†∑Âºè */
.swiper {
  width: 100%;
  padding: 32px 0;
}

.swiper-slide {
  height: calc((100% - 16px) / 2) !important;
  transition: transform 0.3s;
}

:global(.swiper-slide-active) {
  transform: scale(1.05);
}

/* ÂàÜÈ°µÂô®Ê†∑Âºè */
:global(.swiper-pagination) {
  position: relative !important;
  bottom: 0 !important;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  padding: 8px 0;
}

:global(.swiper-pagination-bullet) {
  width: 32px !important;
  height: 32px !important;
  background: transparent !important;
  opacity: 1 !important;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

:global(.swiper-pagination-bullet .dot) {
  width: 10px;
  height: 10px;
  background: #D1D5DB;
  border-radius: 50%;
  transition: all 0.3s;
}

:global(.swiper-pagination-bullet-active) {
  background: rgba(16, 185, 129, 0.1) !important;
  border-radius: 50%;
}

:global(.swiper-pagination-bullet-active .dot) {
  background: #10B981;
  transform: scale(1.2);
}

/* PhotoSwipe Ëá™ÂÆö‰πâ‰∏ªÈ¢ò */
:global(.pswp) {
  --pswp-bg: #000;
  --pswp-error-text-color: #fff;
  --pswp-icon-color: #fff;
  --pswp-icon-color-secondary: #4b5563;
}

:global(.pswp__counter) {
  font-size: 14px;
  opacity: 0.85;
}

:global(.pswp__button) {
  opacity: 0.8;
  transition: opacity 0.2s;
}

:global(.pswp__button:hover) {
  opacity: 1;
}

/* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
@media (max-width: 768px) {
  .swiper {
    padding: 16px 0;
  }
  
  .swiper-slide {
    height: calc((100% - 8px) / 2) !important;
  }

  :global(.swiper-pagination-bullet) {
    width: 24px !important;
    height: 24px !important;
  }
}
</style>