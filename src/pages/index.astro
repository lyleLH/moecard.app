---
import SimpleLayout from '~/layouts/SimpleLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Features from '~/components/widgets/Features.astro';
import Steps from '~/components/widgets/Steps.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Twemoji from '~/components/common/Twemoji.astro';
import { Image } from 'astro:assets';
import appLogo from '~/assets/images/applogo.png';
import testImage from '~/assets/images/samples/000001.jpg';
import SamplesGrid from '~/components/widgets/SamplesGrid.astro';

// æµ‹è¯•è¾“å‡º
console.log('Test image import:', testImage);

// åŠ¨æ€å¯¼å…¥æ‰€æœ‰æ ·æœ¬å›¾ç‰‡
const imageModules = await import.meta.glob('~/assets/images/samples/*.{jpg,JPG}', {
  eager: true
});

// è°ƒè¯•è¾“å‡º
console.log('Available images:', Object.keys(imageModules));

// å°†å¯¼å…¥çš„å›¾ç‰‡è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
const samples = Object.entries(imageModules).map(([path, module]) => ({
  image: (module as any).default,
  title: path.split('/').pop()?.split('.')[0] || ''
})).sort((a, b) => {
  const numA = parseInt(a.title);
  const numB = parseInt(b.title);
  return numA - numB;
});

// æ›´å¤šè°ƒè¯•ä¿¡æ¯
console.log('Sample entries:', samples);

const metadata = {
  title: 'MoeCard - å¯çˆ±çš„å¡ç‰‡åˆ›ä½œå·¥å…·',
  description: 'ç®€å•è€Œå¼ºå¤§çš„å¡ç‰‡åˆ›ä½œå·¥å…·ï¼Œè®©åˆ›ä½œå˜å¾—è½»æ¾æœ‰è¶£ï¼',
  openGraph: {
    image: {
      src: appLogo,
      alt: 'MoeCard Logo'
    }
  }
};

const proFeatures = [
  {
    title: 'Twemoji Picker',
    description: 'Use complete emoji picker for your designs',
    icon: 'ğŸ˜Š',
    color: 'bg-amber-50 dark:bg-amber-900/20'
  },
  {
    title: 'Unlimited Drafts',
    description: 'Save unlimited drafts, continue creating anytime',
    icon: 'âœï¸',
    color: 'bg-blue-50 dark:bg-blue-900/20'
  },
  {
    title: 'Custom Materials',
    description: 'Add and manage your own image library',
    icon: 'ğŸ¨',
    color: 'bg-rose-50 dark:bg-rose-900/20'
  },
  {
    title: 'No Watermark Export',
    description: 'Export high-quality works without watermark',
    icon: 'â¬‡ï¸',
    color: 'bg-green-50 dark:bg-green-900/20'
  }
];

const fontFeatures = [
  {
    title: 'Font Management',
    description: 'Add and use custom fonts',
    icon: 'ğŸ”¤',
    color: 'bg-purple-50 dark:bg-purple-900/20'
  }
];

// è®¡ç®—åˆ†é¡µ
const ITEMS_PER_PAGE = 6;
const totalPages = Math.ceil(samples.length / ITEMS_PER_PAGE);

// åˆå§‹é¡µï¿½ï¿½ï¿½ä¸º1
const currentPage = 1;

---

<SimpleLayout metadata={metadata}>
  <!-- Hero Widget -->
  <Hero
    tagline={{
      text: "è®©åˆ›ä½œå˜å¾—è½»æ¾æœ‰è¶£",
      emoji: "âœ¨"
    }}
    actions={[
      {
        variant: 'primary',
        text: 'ç«‹å³ä¸‹è½½',
        href: '#download',
        emoji: 'ğŸ“±'
      },
      {
        text: 'äº†è§£æ›´å¤š',
        href: '#features',
        emoji: 'ğŸ¨'
      },
    ]}
    image={{
      src: '~/assets/images/hero-moecard.png',
      alt: 'MoeCard App screenshot',
    }}
  >
    <Fragment slot="title">
      <div class="flex items-center justify-center gap-4">
        <Image 
          src={appLogo} 
          alt="MoeCard Logo" 
          class="w-16 h-16" 
          width={64} 
          height={64}
        />
        <span>Moe<span class="text-primary">Card</span></span>
      </div>
    </Fragment>

    <Fragment slot="subtitle">
      <span class="hidden sm:inline">
        å¯çˆ±è€Œå¼ºå¤§çš„å¡ç‰‡åˆ›ä½œå·¥å…·ï¼ç²¾ç¾å­—ä½“ï¼Œä¸°å¯Œè¡¨æƒ…ï¼Œ
        è®©åˆ›ä½œå˜å¾—è½»æ¾æœ‰è¶£ã€‚
      </span>
    </Fragment>
  </Hero>

  <!-- Samples Section -->
  {samples.length > 0 && (
    <section class="py-16 sm:py-20 bg-gray-50 dark:bg-slate-800">
      <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
        <div class="flex flex-col gap-8 md:gap-12">
          <div class="text-center">
            <h2 class="text-3xl font-medium tracking-tight sm:text-4xl">åˆ›ä½œå±•ç¤º</h2>
            <p class="mt-4 text-lg text-muted">çœ‹çœ‹èƒ½ç”¨ MoeCard åˆ›ä½œä»€ä¹ˆ</p>
          </div>
          
          <SamplesGrid samples={samples} />
        </div>
      </div>
    </section>
  )}

  <!-- Pro Features Section -->
  <section class="py-16 sm:py-20">
    <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
      <div class="flex flex-col gap-16">
        <!-- Pro Features -->
        <div class="flex flex-col gap-8">
          <h2 class="text-3xl font-medium tracking-tight sm:text-4xl">Pro Features</h2>
          <p class="text-lg text-muted">Unlock all premium features</p>
          <div class="grid gap-6 sm:grid-cols-2">
            {
              proFeatures.map(({ title, description, icon, color }) => (
                <div class={`flex flex-col gap-4 rounded-3xl ${color} p-8 transition-all duration-300 hover:scale-[1.01]`}>
                  <div class="flex gap-4 items-center">
                    <span class="text-4xl">{icon}</span>
                    <h3 class="text-xl font-medium">{title}</h3>
                  </div>
                  <p class="text-muted">{description}</p>
                </div>
              ))
            }
          </div>
        </div>

        <!-- Font Management -->
        <div class="flex flex-col gap-8">
          <h2 class="text-3xl font-medium tracking-tight sm:text-4xl">Font Management</h2>
          <p class="text-lg text-muted">Manage and use custom fonts</p>
          <div class="grid gap-6">
            {
              fontFeatures.map(({ title, description, icon, color }) => (
                <div class={`flex flex-col gap-4 rounded-3xl ${color} p-8 transition-all duration-300 hover:scale-[1.01]`}>
                  <div class="flex gap-4 items-center">
                    <span class="text-4xl">{icon}</span>
                    <h3 class="text-xl font-medium">{title}</h3>
                  </div>
                  <p class="text-muted">{description}</p>
                </div>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Steps Widget -->
  <Steps
    title="ä¸‰æ­¥å¼€å¯åˆ›ä½œä¹‹æ—…"
    items={[
      {
        title: 'ç¬¬ä¸€æ­¥: <span class="font-medium">ä¸‹è½½å®‰è£…</span>',
        description: 'ä»åº”ç”¨å•†åº—ä¸‹è½½ MoeCardï¼Œç®€å•å®‰è£…å³å¯å¼€å§‹ä½¿ç”¨ã€‚',
        emoji: 'ğŸ“±'
      },
      {
        title: 'ç¬¬äºŒæ­¥: <span class="font-medium">é€‰æ‹©æ¨¡æ¿</span>',
        description: 'æŒ‘é€‰å¿ƒä»ªçš„å¡ç‰‡æ¨¡æ¿ï¼Œæˆ–ä»ç©ºç™½å¼€å§‹åˆ›ä½œã€‚',
        emoji: 'âœ¨'
      },
      {
        title: 'ç¬¬ä¸‰æ­¥: <span class="font-medium">å¼€å§‹åˆ›ä½œ</span>',
        description: 'ä½¿ç”¨ç›´è§‚çš„æ‰‹åŠ¿æ“ä½œï¼Œåˆ›ä½œå±äºæ‚¨çš„ç²¾ç¾å¡ç‰‡ã€‚',
        emoji: 'ğŸ¨'
      },
    ]}
  />

  <!-- CallToAction Widget -->
  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: 'ç«‹å³ä¸‹è½½',
        href: '#',
        emoji: 'ğŸ“±'
      },
    ]}
  >
    <Fragment slot="title">
      å‡†å¤‡å¥½å¼€å§‹åˆ›ä½œäº†å—ï¼Ÿ
    </Fragment>

    <Fragment slot="subtitle">
      ä¸‹è½½ MoeCardï¼Œäº«å—æµç•…çš„å¡ç‰‡åˆ›ä½œä½“éªŒã€‚æ”¯æŒ iOS å’Œ Android è®¾å¤‡ã€‚
    </Fragment>
  </CallToAction>
</SimpleLayout>
