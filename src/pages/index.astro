---
import SimpleLayout from '~/layouts/SimpleLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Features from '~/components/widgets/Features.astro';
import Steps from '~/components/widgets/Steps.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Twemoji from '~/components/common/Twemoji.astro';
import { Image } from 'astro:assets';
import appLogo from '~/assets/images/applogo.png';
import testImage from '~/assets/images/samples/000001.jpg';
import SamplesGrid from '~/components/widgets/SamplesGrid.astro';

// 测试输出
console.log('Test image import:', testImage);

// 动态导入所有样本图片
const imageModules = await import.meta.glob('~/assets/images/samples/*.{jpg,JPG}', {
  eager: true
});

// 调试输出
console.log('Available images:', Object.keys(imageModules));

// 将导入的图片转换为数组并排序
const samples = Object.entries(imageModules).map(([path, module]) => ({
  image: (module as any).default,
  title: path.split('/').pop()?.split('.')[0] || ''
})).sort((a, b) => {
  const numA = parseInt(a.title);
  const numB = parseInt(b.title);
  return numA - numB;
});

// 更多调试信息
console.log('Sample entries:', samples);

const metadata = {
  title: 'MoeCard - 可爱的卡片创作工具',
  description: '简单而强大的卡片创作工具，让创作变得轻松有趣！',
  openGraph: {
    image: {
      src: appLogo,
      alt: 'MoeCard Logo'
    }
  }
};

const proFeatures = [
  {
    title: 'Twemoji Picker',
    description: 'Use complete emoji picker for your designs',
    icon: '😊',
    color: 'bg-amber-50 dark:bg-amber-900/20'
  },
  {
    title: 'Unlimited Drafts',
    description: 'Save unlimited drafts, continue creating anytime',
    icon: '✏️',
    color: 'bg-blue-50 dark:bg-blue-900/20'
  },
  {
    title: 'Custom Materials',
    description: 'Add and manage your own image library',
    icon: '🎨',
    color: 'bg-rose-50 dark:bg-rose-900/20'
  },
  {
    title: 'No Watermark Export',
    description: 'Export high-quality works without watermark',
    icon: '⬇️',
    color: 'bg-green-50 dark:bg-green-900/20'
  }
];

const fontFeatures = [
  {
    title: 'Font Management',
    description: 'Add and use custom fonts',
    icon: '🔤',
    color: 'bg-purple-50 dark:bg-purple-900/20'
  }
];

// 计算分页
const ITEMS_PER_PAGE = 6;
const totalPages = Math.ceil(samples.length / ITEMS_PER_PAGE);

// 初始页���为1
const currentPage = 1;

---

<SimpleLayout metadata={metadata}>
  <!-- Hero Widget -->
  <Hero
    tagline={{
      text: "让创作变得轻松有趣",
      emoji: "✨"
    }}
    actions={[
      {
        variant: 'primary',
        text: '立即下载',
        href: '#download',
        emoji: '📱'
      },
      {
        text: '了解更多',
        href: '#features',
        emoji: '🎨'
      },
    ]}
    image={{
      src: '~/assets/images/hero-moecard.png',
      alt: 'MoeCard App screenshot',
    }}
  >
    <Fragment slot="title">
      <div class="flex items-center justify-center gap-4">
        <Image 
          src={appLogo} 
          alt="MoeCard Logo" 
          class="w-16 h-16" 
          width={64} 
          height={64}
        />
        <span>Moe<span class="text-primary">Card</span></span>
      </div>
    </Fragment>

    <Fragment slot="subtitle">
      <span class="hidden sm:inline">
        可爱而强大的卡片创作工具！精美字体，丰富表情，
        让创作变得轻松有趣。
      </span>
    </Fragment>
  </Hero>

  <!-- Samples Section -->
  {samples.length > 0 && (
    <section class="py-16 sm:py-20 bg-gray-50 dark:bg-slate-800">
      <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
        <div class="flex flex-col gap-8 md:gap-12">
          <div class="text-center">
            <h2 class="text-3xl font-medium tracking-tight sm:text-4xl">创作展示</h2>
            <p class="mt-4 text-lg text-muted">看看能用 MoeCard 创作什么</p>
          </div>
          
          <SamplesGrid samples={samples} />
        </div>
      </div>
    </section>
  )}

  <!-- Pro Features Section -->
  <section class="py-16 sm:py-20">
    <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
      <div class="flex flex-col gap-16">
        <!-- Pro Features -->
        <div class="flex flex-col gap-8">
          <h2 class="text-3xl font-medium tracking-tight sm:text-4xl">Pro Features</h2>
          <p class="text-lg text-muted">Unlock all premium features</p>
          <div class="grid gap-6 sm:grid-cols-2">
            {
              proFeatures.map(({ title, description, icon, color }) => (
                <div class={`flex flex-col gap-4 rounded-3xl ${color} p-8 transition-all duration-300 hover:scale-[1.01]`}>
                  <div class="flex gap-4 items-center">
                    <span class="text-4xl">{icon}</span>
                    <h3 class="text-xl font-medium">{title}</h3>
                  </div>
                  <p class="text-muted">{description}</p>
                </div>
              ))
            }
          </div>
        </div>

        <!-- Font Management -->
        <div class="flex flex-col gap-8">
          <h2 class="text-3xl font-medium tracking-tight sm:text-4xl">Font Management</h2>
          <p class="text-lg text-muted">Manage and use custom fonts</p>
          <div class="grid gap-6">
            {
              fontFeatures.map(({ title, description, icon, color }) => (
                <div class={`flex flex-col gap-4 rounded-3xl ${color} p-8 transition-all duration-300 hover:scale-[1.01]`}>
                  <div class="flex gap-4 items-center">
                    <span class="text-4xl">{icon}</span>
                    <h3 class="text-xl font-medium">{title}</h3>
                  </div>
                  <p class="text-muted">{description}</p>
                </div>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Steps Widget -->
  <Steps
    title="三步开启创作之旅"
    items={[
      {
        title: '第一步: <span class="font-medium">下载安装</span>',
        description: '从应用商店下载 MoeCard，简单安装即可开始使用。',
        emoji: '📱'
      },
      {
        title: '第二步: <span class="font-medium">选择模板</span>',
        description: '挑选心仪的卡片模板，或从空白开始创作。',
        emoji: '✨'
      },
      {
        title: '第三步: <span class="font-medium">开始创作</span>',
        description: '使用直观的手势操作，创作属于您的精美卡片。',
        emoji: '🎨'
      },
    ]}
  />

  <!-- CallToAction Widget -->
  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: '立即下载',
        href: '#',
        emoji: '📱'
      },
    ]}
  >
    <Fragment slot="title">
      准备好开始创作了吗？
    </Fragment>

    <Fragment slot="subtitle">
      下载 MoeCard，享受流畅的卡片创作体验。支持 iOS 和 Android 设备。
    </Fragment>
  </CallToAction>
</SimpleLayout>
